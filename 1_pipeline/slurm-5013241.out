Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 1 (use --cores to define parallelism)
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=1000, mem_mib=954, disk_mb=1000, disk_mib=954
Select jobs to execute...

[Wed Mar  1 14:20:42 2023]
rule kallisto_alignment:
    input: ../data/lightning/about_files/about-condition-G4_rep2.txt
    output: /project/sims-lab/lmorrill/data/lightning/alignment/KallistoOUT/dmel649Chrimson/G4_rep2/counts_unfiltered/cells_x_genes.mtx
    log: logs/kallisto_count_G4_rep2
    jobid: 0
    reason: Missing output files: /project/sims-lab/lmorrill/data/lightning/alignment/KallistoOUT/dmel649Chrimson/G4_rep2/counts_unfiltered/cells_x_genes.mtx
    wildcards: sample=G4_rep2
    resources: mem_mb=1000, mem_mib=954, disk_mb=1000, disk_mib=954, tmpdir=/Filers/scratch/lmorrill/5013241

kb count /project/cncb/shared/proj002/backup/CELLRANGER_OUT/636200_21/636200_21_S27_L001_R1_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/636200_21/636200_21_S27_L001_R2_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/654654_21/654654_21_S15_L007_R1_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/654654_21/654654_21_S15_L007_R2_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660727_21/660727_21_S16_L003_R1_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660727_21/660727_21_S16_L003_R2_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660728_21/660728_21_S44_L004_R1_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660728_21/660728_21_S44_L004_R2_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660729_21/660729_21_S52_L005_R1_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660729_21/660729_21_S52_L005_R2_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660730_21/660730_21_S8_L006_R1_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660730_21/660730_21_S8_L006_R2_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660731_21/660731_21_S24_L007_R1_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660731_21/660731_21_S24_L007_R2_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660732_21/660732_21_S34_L008_R1_001.fastq.gz /project/cncb/shared/proj002/backup/CELLRANGER_OUT/660732_21/660732_21_S34_L008_R2_001.fastq.gz  -o /project/sims-lab/lmorrill/data/lightning/alignment/KallistoOUT/dmel649Chrimson/G4_rep2/counts_unfiltered/cells_x_genes.mtx -i ~/projects/general/genomes_kallisto/dmel-all-r6.49_CORRECTED_Chrimson_KallistoINDEX -g ~/projects/general/genomes_kallisto/dmel-all-r6.49_CORRECTED_Chrimson_KallistoT2G -x 10XV3
[2023-03-01 14:20:48,877]   ERROR [main] An exception occurred
Traceback (most recent call last):
  File "/home/l/lmorrill/t1data/conda/rufus_env/envs/py310/lib/python3.10/site-packages/kb_python/main.py", line 1305, in main
    COMMAND_TO_FUNCTION[args.command](parser, args, temp_dir=temp_dir)
  File "/home/l/lmorrill/t1data/conda/rufus_env/envs/py310/lib/python3.10/site-packages/kb_python/main.py", line 550, in parse_count
    count(
  File "/home/l/lmorrill/t1data/conda/rufus_env/envs/py310/lib/python3.10/site-packages/ngs_tools/logging.py", line 62, in inner
    return func(*args, **kwargs)
  File "/home/l/lmorrill/t1data/conda/rufus_env/envs/py310/lib/python3.10/site-packages/kb_python/count.py", line 1038, in count
    bus_result = kallisto_bus(
  File "/home/l/lmorrill/t1data/conda/rufus_env/envs/py310/lib/python3.10/site-packages/kb_python/validate.py", line 114, in inner
    validate(arg)
  File "/home/l/lmorrill/t1data/conda/rufus_env/envs/py310/lib/python3.10/site-packages/kb_python/validate.py", line 88, in validate
    VALIDATORS[ext](path)
  File "/home/l/lmorrill/t1data/conda/rufus_env/envs/py310/lib/python3.10/site-packages/kb_python/validate.py", line 55, in validate_mtx
    scipy.io.mmread(path)
  File "/home/l/lmorrill/t1data/conda/rufus_env/envs/py310/lib/python3.10/site-packages/scipy/io/_mmio.py", line 129, in mmread
    return MMFile().read(source)
  File "/home/l/lmorrill/t1data/conda/rufus_env/envs/py310/lib/python3.10/site-packages/scipy/io/_mmio.py", line 575, in read
    stream, close_it = self._open(source)
  File "/home/l/lmorrill/t1data/conda/rufus_env/envs/py310/lib/python3.10/site-packages/scipy/io/_mmio.py", line 469, in _open
    stream = open(filespec, mode)
IsADirectoryError: [Errno 21] Is a directory: '/project/sims-lab/lmorrill/data/lightning/alignment/KallistoOUT/dmel649Chrimson/G4_rep2/counts_unfiltered/cells_x_genes.mtx'
ImproperOutputException in rule kallisto_alignment in file /Filers/home/l/lmorrill/projects/lighting/1_pipeline/Snakefile, line 75:
Outputs of incorrect type (directories when expecting files or vice versa). Output directories must be flagged with directory(). for rule kallisto_alignment:
    output: /project/sims-lab/lmorrill/data/lightning/alignment/KallistoOUT/dmel649Chrimson/G4_rep2/counts_unfiltered/cells_x_genes.mtx
    wildcards: sample=G4_rep2
    affected files:
        /project/sims-lab/lmorrill/data/lightning/alignment/KallistoOUT/dmel649Chrimson/G4_rep2/counts_unfiltered/cells_x_genes.mtx
Removing output files of failed job kallisto_alignment since they might be corrupted:
/project/sims-lab/lmorrill/data/lightning/alignment/KallistoOUT/dmel649Chrimson/G4_rep2/counts_unfiltered/cells_x_genes.mtx
Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
Using Kallisto
The OUT folder is: /project/sims-lab/lmorrill/data/lightning/alignment/KallistoOUT/
    sample                                              cells
0  G1_rep1  636200_14,654654_14,660727_14,660728_14,660729...
1  G1_rep2  636200_18,654654_18,660727_18,660728_18,660729...
2  G2_rep1  636200_15,654654_15,660727_15,660728_15,660729...
3  G2_rep2  636200_19,654654_19,660727_19,660728_19,660729...
4  G3_rep1  636200_16,654654_16,660727_16,660728_16,660729...
5  G3_rep2  636200_20,654654_20,660727_20,660728_20,660729...
6  G4_rep1  636200_17,654654_17,660727_17,660728_17,660729...
7  G4_rep2  636200_21,654654_21,660727_21,660728_21,660729...
CBB Profiling started Wed Mar  1 14:20:40 2023
SLURM_JOB_ID		5013241
REQ_CPU_CORES		1
REQ_MEMORY_GB		10.000000
Starting profiling...

                                                                                
                                                                                
                                    CPU (cores)                                 
    1 +---------------------------------------------------------------------+   
      |       +       +      +       +       +       +      +       +       |   
      |                                                                     |   
      |                                                                     |   
      |                                                                     |   
  0.8 |-+                                                                 +-|   
      |                      ####                                           |   
      |                    ##    #####                                      |   
      |                   #           ##                                    |   
  0.6 |-+                #              ##                                +-|   
      |                ##                 ##                                |   
      |              ##                     #####                           |   
      |            ##                            #############              |   
      |          ##                                           ####          |   
  0.4 |-+      ##                                                 ###     +-|   
      |       #                                                      #      |   
      |      #                                                        #     |   
      |     #                                                          #    |   
  0.2 |-+  #                                                            # +-|   
      |   #                                                             #   |   
      |  #                                                               #  |   
      | #                                                                 # |   
      |#      +       +      +       +       +       +      +       +      #|   
    0 +---------------------------------------------------------------------+   
      0       1       2      3       4       5       6      7       8       9   
                                Job profiling step                              
                                                                                

                                                                                
                                                                                
                                   Memory (GB)                                  
  10 +----------------------------------------------------------------------+   
     |       +       +       +       +      +       +       +       +       |   
   9 |-+                                                                  +-|   
     |                                                                      |   
     |                                                                      |   
   8 |-+                                                                  +-|   
     |                                                                      |   
   7 |-+                                                                  +-|   
     |                                                                      |   
   6 |-+                                                                  +-|   
     |                                                                      |   
   5 |-+                                                                  +-|   
     |                                                                      |   
     |                                                                      |   
   4 |-+                                                                  +-|   
     |                                                                      |   
   3 |-+                                                                  +-|   
     |                                                                      |   
   2 |-+                                                                  +-|   
     |                                                                      |   
     |                                                                      |   
   1 |-+                                                                  +-|   
     |       +       +       +       +      +   ########################    |   
   0 +----------------------------------------------------------------------+   
     0       1       2       3       4      5       6       7       8       9   
                               Job profiling step                               
                                                                                

                                                                                
                                                                                
                                   Data read (GB)                               
  8e-06 +-------------------------------------------------------------------+   
        |       +      ##############################################       |   
        |              #                                            #       |   
  7e-06 |-+           #                                              #    +-|   
        |             #                                              #      |   
        |             #                                              #      |   
  6e-06 |-+          #                                                #   +-|   
        |            #                                                #     |   
        |            #                                                 #    |   
  5e-06 |-+         #                                                  #  +-|   
        |           #                                                  #    |   
  4e-06 |-+         #                                                   # +-|   
        |           #                                                   #   |   
        |          #                                                    #   |   
  3e-06 |-+        #                                                     #+-|   
        |          #                                                     #  |   
        |         #                                                      #  |   
  2e-06 |-+       #                                                       #-|   
        |         #                                                       # |   
        |        #                                                         #|   
  1e-06 |-+      #                                                        +#|   
        |        #                                                         #|   
        |       #      +       +      +       +      +       +      +       |   
      0 +-------------------------------------------------------------------+   
        0       1      2       3      4       5      6       7      8       9   
                                 Job profiling step                             
                                                                                

                                                                                
                                                                                
                                   Data written (GB)                            
  0.00016 +-----------------------------------------------------------------+   
          |      +       +      +      +       +      +      +       +      |   
          |                                                        ######   |   
  0.00014 |-+                                                  ####      ###|   
          |                                                 ###             |   
          |                                               ##                |   
  0.00012 |-+                                           ##                +-|   
          |                                          ###                    |   
          |                                      ####                       |   
   0.0001 |-+                                ####                         +-|   
          |                              ####                               |   
    8e-05 |-+                         ###                                 +-|   
          |                       ####                                      |   
          |                    ###                                          |   
    6e-05 |-+              ####                                           +-|   
          |              ##                                                 |   
          |            ##                                                   |   
    4e-05 |-+        ##                                                   +-|   
          |         #                                                       |   
          |       ##                                                        |   
    2e-05 |-+   ##                                                        +-|   
          |   ##                                                            |   
          | ##   +       +      +      +       +      +      +       +      |   
        0 +-----------------------------------------------------------------+   
          0      1       2      3      4       5      6      7       8      9   
                                  Job profiling step                            
                                                                                
